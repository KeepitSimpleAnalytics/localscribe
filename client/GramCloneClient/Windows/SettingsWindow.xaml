<Window x:Class="GramCloneClient.Windows.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="LocalScribe Settings"
        Width="460"
        MinHeight="200"
        MaxHeight="800"
        SizeToContent="Height"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="12">

            <!-- 1. Connection -->
            <Expander Header="Connection" IsExpanded="False" Margin="0,0,0,8">
                <StackPanel Margin="20,8,0,0">
                    <TextBlock Text="Backend URL (FastAPI)" FontWeight="Bold"/>
                    <TextBox x:Name="BackendUrlBox"/>

                    <CheckBox x:Name="AutoStartCheckBox" Content="Auto-start Backend Process" Margin="0,12,0,4"/>
                    <StackPanel x:Name="AutoStartConfigPanel" Margin="20,0,0,0">
                        <TextBlock Text="Startup Command" FontWeight="Bold" Margin="0,4,0,0"/>
                        <TextBox x:Name="StartupCommandBox" TextWrapping="Wrap" Height="36" AcceptsReturn="False"/>
                        <TextBlock Text="Working Directory" FontWeight="Bold" Margin="0,4,0,0"/>
                        <TextBox x:Name="WorkDirBox"/>
                        <TextBlock Text="(Leave empty to use app directory)" FontStyle="Italic" Foreground="Gray" FontSize="10"/>
                    </StackPanel>

                    <TextBlock Text="Ollama Base URL" FontWeight="Bold" Margin="0,12,0,0"/>
                    <TextBox x:Name="OllamaUrlBox"/>

                    <Grid Margin="0,12,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                            <TextBlock x:Name="BackendConnectionStatus"
                                       Text="Backend: Unknown"
                                       Foreground="Gray"
                                       Margin="0,0,0,2"/>
                            <TextBlock x:Name="OllamaConnectionStatus"
                                       Text="Ollama: Unknown"
                                       Foreground="Gray"/>
                        </StackPanel>
                        <Button Grid.Column="1"
                                Content="Check &amp; Reload"
                                Width="120"
                                Margin="12,0,0,0"
                                Click="ReloadModelsButton_OnClick"/>
                    </Grid>
                </StackPanel>
            </Expander>

            <!-- 2. Input & Defaults -->
            <Expander Header="Input &amp; Defaults" IsExpanded="False" Margin="0,0,0,8">
                <StackPanel Margin="20,8,0,0">
                    <TextBlock Text="Hotkey (e.g. Ctrl+Alt+G)" FontWeight="Bold"/>
                    <TextBox x:Name="HotkeyBox"/>

                    <Grid Margin="0,12,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Default Mode" FontWeight="Bold"/>
                            <ComboBox x:Name="ModeCombo"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Default Tone" FontWeight="Bold"/>
                            <ComboBox x:Name="ToneCombo"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Expander>

            <!-- 3. Error Highlighting -->
            <Expander Header="Error Highlighting" IsExpanded="False" Margin="0,0,0,8">
                <StackPanel Margin="20,8,0,0">
                    <CheckBox x:Name="OverlayEnabledCheckBox" Content="Enable error underlines" Margin="0,0,0,8"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Underline Color"/>
                            <ComboBox x:Name="OverlayColorCombo" SelectionChanged="OverlayColorCombo_SelectionChanged"/>
                            <StackPanel x:Name="CustomColorPanel" Visibility="Collapsed" Margin="0,4,0,0">
                                <TextBlock Text="Hex Color (e.g. #FF3C3C)" FontSize="10" Foreground="Gray"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Border x:Name="ColorPreviewBox" Width="24" Height="24"
                                            BorderBrush="Gray" BorderThickness="1" Margin="0,0,8,0"
                                            Background="#FFFF3C3C"/>
                                    <TextBox x:Name="CustomColorBox" Grid.Column="1" Text="#FF3C3C"
                                             TextChanged="CustomColorBox_TextChanged"/>
                                </Grid>
                            </StackPanel>
                        </StackPanel>
                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Underline Style"/>
                            <ComboBox x:Name="OverlayStyleCombo"/>
                        </StackPanel>
                    </Grid>

                    <StackPanel Margin="0,8,0,0">
                        <TextBlock>
                            <Run Text="Opacity: "/><Run x:Name="OpacityValueText" Text="78"/>%
                        </TextBlock>
                        <Slider x:Name="OpacitySlider" Minimum="20" Maximum="100" Value="78"
                                TickFrequency="10" IsSnapToTickEnabled="False"
                                ValueChanged="OpacitySlider_ValueChanged"/>
                    </StackPanel>

                    <StackPanel Margin="0,4,0,0">
                        <TextBlock>
                            <Run Text="Thickness: "/><Run x:Name="ThicknessValueText" Text="2.5"/> px
                        </TextBlock>
                        <Slider x:Name="ThicknessSlider" Minimum="1" Maximum="6" Value="2.5"
                                TickFrequency="0.5" IsSnapToTickEnabled="False"
                                ValueChanged="ThicknessSlider_ValueChanged"/>
                    </StackPanel>
                </StackPanel>
            </Expander>

            <!-- 4. Grammar Rules (NEW) -->
            <Expander Header="Grammar Rules" IsExpanded="False" Margin="0,0,0,8">
                <StackPanel Margin="20,8,0,0">
                    <TextBlock Text="Quick Preset" FontWeight="Bold"/>
                    <TextBlock Text="Choose a preset or customize categories below"
                               FontStyle="Italic" Foreground="Gray" FontSize="10" Margin="0,2,0,4"/>
                    <ComboBox x:Name="GrammarPresetCombo" Width="200" HorizontalAlignment="Left"
                              SelectionChanged="GrammarPresetCombo_SelectionChanged"/>

                    <TextBlock Text="Categories" FontWeight="Bold" Margin="0,12,0,8"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Left Column -->
                        <StackPanel Grid.Column="0">
                            <CheckBox x:Name="CatGrammarCheck" Content="Grammar" Margin="0,2"
                                      Click="CategoryCheckBox_Click"/>
                            <CheckBox x:Name="CatSpellingCheck" Content="Spelling" Margin="0,2"
                                      Click="CategoryCheckBox_Click"/>
                            <CheckBox x:Name="CatPunctuationCheck" Content="Punctuation" Margin="0,2"
                                      Click="CategoryCheckBox_Click"/>
                            <CheckBox x:Name="CatTypographyCheck" Content="Typography" Margin="0,2"
                                      Click="CategoryCheckBox_Click"/>
                            <CheckBox x:Name="CatStyleCheck" Content="Style" Margin="0,2"
                                      Click="CategoryCheckBox_Click"/>
                            <CheckBox x:Name="CatConfusedWordsCheck" Content="Confused Words" Margin="0,2"
                                      Click="CategoryCheckBox_Click"/>
                            <CheckBox x:Name="CatRedundancyCheck" Content="Redundancy" Margin="0,2"
                                      Click="CategoryCheckBox_Click"/>
                        </StackPanel>

                        <!-- Right Column -->
                        <StackPanel Grid.Column="1">
                            <CheckBox x:Name="CatCasingCheck" Content="Casing" Margin="0,2"
                                      Click="CategoryCheckBox_Click"/>
                            <CheckBox x:Name="CatSemanticsCheck" Content="Semantics" Margin="0,2"
                                      Click="CategoryCheckBox_Click"/>
                            <CheckBox x:Name="CatColloquialismsCheck" Content="Colloquialisms" Margin="0,2"
                                      Click="CategoryCheckBox_Click"/>
                            <CheckBox x:Name="CatCompoundingCheck" Content="Compounding" Margin="0,2"
                                      Click="CategoryCheckBox_Click"/>
                            <CheckBox x:Name="CatPlainEnglishCheck" Content="Plain English" Margin="0,2"
                                      Click="CategoryCheckBox_Click"/>
                            <CheckBox x:Name="CatWikipediaCheck" Content="Wikipedia" Margin="0,2"
                                      Click="CategoryCheckBox_Click"/>
                            <CheckBox x:Name="CatMiscCheck" Content="Miscellaneous" Margin="0,2"
                                      Click="CategoryCheckBox_Click"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Expander>

            <!-- 5. Timing -->
            <Expander Header="Timing" IsExpanded="False" Margin="0,0,0,8">
                <StackPanel Margin="20,8,0,0">
                    <StackPanel>
                        <TextBlock>
                            <Run Text="Check delay: "/><Run x:Name="DebounceValueText" Text="750"/> ms
                        </TextBlock>
                        <TextBlock Text="(wait after typing before checking)" FontStyle="Italic" Foreground="Gray" FontSize="10"/>
                        <Slider x:Name="DebounceSlider" Minimum="200" Maximum="2000" Value="750"
                                TickFrequency="100" IsSnapToTickEnabled="False"
                                ValueChanged="DebounceSlider_ValueChanged"/>
                    </StackPanel>

                    <StackPanel Margin="0,8,0,0">
                        <TextBlock>
                            <Run Text="Polling interval: "/><Run x:Name="PollingValueText" Text="150"/> ms
                        </TextBlock>
                        <TextBlock Text="(how often to check for text changes)" FontStyle="Italic" Foreground="Gray" FontSize="10"/>
                        <Slider x:Name="PollingSlider" Minimum="100" Maximum="500" Value="150"
                                TickFrequency="50" IsSnapToTickEnabled="False"
                                ValueChanged="PollingSlider_ValueChanged"/>
                    </StackPanel>
                </StackPanel>
            </Expander>

            <!-- 6. Models -->
            <Expander Header="Models" IsExpanded="False" Margin="0,0,0,8">
                <StackPanel Margin="20,8,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Proofread Model" FontWeight="Bold"/>
                            <ComboBox x:Name="GrammarModelCombo" IsEditable="True"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Rewrite/Tone/Technical Model" FontWeight="Bold"/>
                            <ComboBox x:Name="GeneralModelCombo" IsEditable="True"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Expander>

            <!-- Save/Cancel (always visible) -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
                <Button Content="Save" Width="80" Margin="0,0,8,0" Click="SaveButton_OnClick"/>
                <Button Content="Cancel" Width="80" Click="CancelButton_OnClick"/>
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</Window>
